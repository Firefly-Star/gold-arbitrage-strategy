# 跨市场联动套利策略研究——以黄金ETF与期货为例

## 核心需求清单
| 模块                | 功能点                     |
|---------------------|---------------------------|
| **行情同步**        | 多源数据实时采集           |
| **数据存储**        | 结构化数据存储与管理       |
| **协整关系分析**    | ADF检验/误差修正模型       |
| **套利信号生成**    | 标准差突破预警机制         |
| **基差预测**        | LSTM时序预测               |

---

## 技术架构方案
| 功能                | 技术栈                     |
|---------------------|---------------------------|
| **操作系统**          | windows 10/11          |
| **开发平台**          | jupyter lab + vscode       |
| **语言**              | python 3.9+       |
| **库**    | Tushare Pro API、Pandas、NumPy、TensorFlow/Keras（LSTM）、Scikit-learn、ipywidgets、SQLAlchemy、Psycopg2         |
| **项目管理工具**        | git               |

---

## 项目管理
**负责人**: 温学周  
**任务跟踪方法**: Git版本管理 + 每日站会 + 代码审查

### 任务层级结构
#### Level 1: 数据获取
| 子任务 | 数据接口                | 数据筛选条件       | 关键字段                     |
|--------|-------------------------|--------------------|-----------------------------|
| 1.1    | `fut_basic`           | AU9999            | 开盘价、收盘价、时间戳       |
| 1.2    | `fut_daily`           | 合约AU0           | 期货价格、成交量、持仓量     |
| 1.3    | `macro_usa`系列        | N/A               | 美元指数、通胀率、非农数据   |
| 1.4    | `fund_portfolio`       | 黄金相关ETF        | 持仓量、资金流入流出         |
| 1.5    | `fut_holding`         | AU主力合约         | 多头持仓、空头持仓、净持仓   |

#### Level 2: 数据存储

#### Level 3: 数据可视化

## 项目管理
**负责人**: 温学周  
**任务跟踪方法**: Git版本管理 + 每日站会 + 代码审查

---

### 任务层级结构

#### Level 1: 数据获取
| 子任务 | 数据接口                | 数据筛选条件       | 关键字段                     |
|--------|-------------------------|--------------------|-----------------------------|
| 1.1    | `fut_basic`           | AU9999            | 开盘价、收盘价、时间戳       |
| 1.2    | `fut_daily`           | 合约AU0           | 期货价格、成交量、持仓量     |
| 1.3    | `macro_usa`系列        | N/A               | 美元指数、通胀率、非农数据   |
| 1.4    | `fund_portfolio`       | 黄金相关ETF        | 持仓量、资金流入流出         |
| 1.5    | `fut_holding`         | AU主力合约         | 多头持仓、空头持仓、净持仓   |

#### Level 2: 数据存储

**​​验收标准**​​:

    数据表规范化程度 (符合3NF)
    数据写入吞吐量 (>1000条/秒)
    数据完整性检测 (缺失值<0.1%)

### Level 3: 数据可视化

| 组件名称                | 可视化类型         | 功能描述                                                                 | 关键指标                   |
|-------------------------|--------------------|--------------------------------------------------------------------------|---------------------------|
| **双坐标价格对比图**    | 组合折线图         | 同步展示黄金现货与期货价格走势                                           | 现货价/期货价/基差差距     |
| **基差历史波动热力图**  | 日历热力图         | 按日期呈现基差波动强度(红=基差扩大, 蓝=基差缩小)                         | 基差幅度/方向              |
| **宏观指标关联矩阵**    | 相关系数矩阵       | 展示宏观经济指标与基差的相关系数                                         | 相关系数(-1~+1)            |
| **ETF持仓变化面积图**   | 堆叠面积图         | 显示主要黄金ETF持仓量变化趋势                                            | 持仓量/资金流向            |
| **多空持仓对比柱状图**  | 分组柱状图         | 对比期货市场多头与空头仓位变化      

### Level 4: 机器学习方法进行交货点的基差预测和收敛路径预测

| 步骤 | 关键方法                     | 技术实现细节                     | 质量验收标准              |
|------|------------------------------|----------------------------------|---------------------------|
| 4.1  | **SQL查询 + 数据缓存**       | PostgreSQL连接池异步查询         | 响应时间 ≤ 2秒           |
|      |                              | Redis内存缓存高频访问数据        | 缓存命中率 >95%          |
| 4.2  | **数据预处理**               | Z-score标准化数值特征            | 通过K-S正态分布检验       |
|      |                              | 线性插补时间序列缺失值            | 缺失值填补率 ≥99.9%      |
| 4.3  | **数据集划分**               | 时序交叉验证                     | 严格避免未来数据泄露      |
|      |                              | 前80%训练集/后20%测试集分割      | 分割点明确记录日志        |
| 4.4  | **特征工程**                 | 滞后变量(t-1至t-7基差序列)       | 特征重要性分析            |
|      |                              | 波动率特征(10日ATR/20日标准差)    | 特征相关性热力图          |
| 4.5  | **模型构建**                 | 3层LSTM网络结构                  | 验证集损失曲线平稳        |
|      | (每层128单元)                | Dropout层防止过拟合             | 梯度消失/爆炸监测         |
| 4.6  | **模型训练**                 | Early Stopping早停机制          | 自动优化训练周期数        |
|      |                              | Adam优化器 + Huber Loss损失函数  | 最佳权重自动保存          |
| 4.7  | **预测展示**                 | Plotly动态图表交互              | MAE ≤ 0.15             |
|      |                              | 95%置信区间可视化               | 预测偏离告警机制        |

### Level 4:将基差预测和收敛路径预测结果展示在ui中

---

## 版本演进路线

### V0.1 概念验证阶段 (6/27-6/29)
| 交付目标               | 关键任务                             |
|------------------------|--------------------------------------|
| 数据管道贯通           | 实现Tushare API到SQL的数据流          |
| 基差预测原型           | 搭建LSTM模型预测框架                  |
| 核心功能演示           | 展示原始基差数据与预测结果            |

### V0.5 中期检查阶段 (6/30-7/1)
| 交付目标               | 关键任务                             |
|------------------------|--------------------------------------|
| 动态UI集成             | 实现ipywidgets交互面板               |
| 模型调优               | 优化LSTM超参数                       |
| 收敛路径预测           | 开发价差收敛概率算法                 |

### V1.0 项目验收阶段 (7/2)
| 交付目标               | 关键任务                             |
|------------------------|--------------------------------------|
| 全功能集成             | 打通数据-模型-UI全链路               |
| 系统部署               | 制作一键运行脚本                     |
| 风险控制模块           | 集成仓位管理与止损机制               |

---

## 技术可行性评估

### 数据层架构
**技术栈**: Tushare Pro API + SQLAlchemy + PostgreSQL  

### 模型层架构
**技术栈**: TensorFlow/Keras + Scikit-learn + Pandas  

### 交互层架构
**技术栈**: ipywidgets + Matplotlib + Jupyter Lab  

---

## 团队实施保障
### 协作机制
- **代码管理**: Git分支工作流  
  `main`(保护分支) ← `dev`(开发分支) ← `feature/xxx`(功能分支)  
- **进度跟踪**: 每日站会 + 燃尽图  
- **质量保障**: 代码审查 + 单元测试覆盖(>70%)